From d16b07c5a54b462e22ad583f876658f0babf313c Mon Sep 17 00:00:00 2001
From: CN_SZTL <cnsztl@project-openwrt.eu.org>
Date: Sat, 28 Nov 2020 23:12:56 +0800
Subject: [PATCH] ag71xx_main: of_get_phy_mode: Change API

of_get_phy_mode API has changed since kernel 5.9 [1].

1. https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git/commit/?h=linux-5.9.y&id=0c65b2b90d13c1deaee6449304dd367c5d4eb8ae

Signed-off-by: CN_SZTL <cnsztl@project-openwrt.eu.org>
---
 drivers/net/ethernet/atheros/ag71xx/ag71xx.h      | 2 +-
 drivers/net/ethernet/atheros/ag71xx/ag71xx_main.c | 6 +++---
 2 files changed, 4 insertions(+), 4 deletions(-)

diff --git a/drivers/net/ethernet/atheros/ag71xx/ag71xx.h b/drivers/net/ethernet/atheros/ag71xx/ag71xx.h
index fde9db3745..1955cd288f 100644
--- a/drivers/net/ethernet/atheros/ag71xx/ag71xx.h
+++ b/drivers/net/ethernet/atheros/ag71xx/ag71xx.h
@@ -178,7 +178,7 @@ struct ag71xx {
 
 	struct phy_device	*phy_dev;
 	void			*phy_priv;
-	int			phy_if_mode;
+	phy_interface_t		phy_if_mode;
 
 	unsigned int		link;
 	unsigned int		speed;
diff --git a/drivers/net/ethernet/atheros/ag71xx/ag71xx_main.c b/drivers/net/ethernet/atheros/ag71xx/ag71xx_main.c
index 09906b2779..882251840b 100644
--- a/drivers/net/ethernet/atheros/ag71xx/ag71xx_main.c
+++ b/drivers/net/ethernet/atheros/ag71xx/ag71xx_main.c
@@ -1667,10 +1667,10 @@ static int ag71xx_probe(struct platform_device *pdev)
 		memcpy(dev->dev_addr, mac_addr, ETH_ALEN);
 	}
 
-	ag->phy_if_mode = of_get_phy_mode(np);
-	if (ag->phy_if_mode < 0) {
+	err = of_get_phy_mode(np, &ag->phy_if_mode);
+	if (err) {
 		dev_err(&pdev->dev, "missing phy-mode property in DT\n");
-		return ag->phy_if_mode;
+		return err;
 	}
 
 	if (of_device_is_compatible(np, "qca,qca9560-eth") &&
-- 
2.20.1

