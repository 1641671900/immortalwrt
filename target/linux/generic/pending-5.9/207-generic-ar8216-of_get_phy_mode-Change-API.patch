From b63963900a5c3fa26258440954e375ed4bc40f22 Mon Sep 17 00:00:00 2001
From: CN_SZTL <cnsztl@project-openwrt.eu.org>
Date: Sat, 28 Nov 2020 23:14:33 +0800
Subject: [PATCH] ar8216: of_get_phy_mode: Change API

of_get_phy_mode API has changed since kernel 5.9 [1].

1. https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git/commit/?h=linux-5.9.y&id=0c65b2b90d13c1deaee6449304dd367c5d4eb8ae

Signed-off-by: CN_SZTL <cnsztl@project-openwrt.eu.org>
---
 drivers/net/phy/ar8216.c | 9 +++++----
 1 file changed, 5 insertions(+), 4 deletions(-)

diff --git a/drivers/net/phy/ar8216.c b/drivers/net/phy/ar8216.c
index 0b0348bfdf..f14dac000b 100644
--- a/drivers/net/phy/ar8216.c
+++ b/drivers/net/phy/ar8216.c
@@ -887,7 +887,8 @@ ar8216_phy_write(struct ar8xxx_priv *priv, int addr, int regnum, u16 val)
 static int
 ar8229_hw_init(struct ar8xxx_priv *priv)
 {
-	int phy_if_mode;
+	phy_interface_t phy_if_mode;
+	int ret;
 
 	if (priv->initialized)
 		return 0;
@@ -895,12 +896,12 @@ ar8229_hw_init(struct ar8xxx_priv *priv)
 	ar8xxx_write(priv, AR8216_REG_CTRL, AR8216_CTRL_RESET);
 	ar8xxx_reg_wait(priv, AR8216_REG_CTRL, AR8216_CTRL_RESET, 0, 1000);
 
-	phy_if_mode = of_get_phy_mode(priv->pdev->of_node);
+	ret = of_get_phy_mode(priv->pdev->of_node, &phy_if_mode);
 
-	if (phy_if_mode == PHY_INTERFACE_MODE_GMII) {
+	if (ret == PHY_INTERFACE_MODE_GMII) {
 		ar8xxx_write(priv, AR8229_REG_OPER_MODE0,
 				 AR8229_OPER_MODE0_MAC_GMII_EN);
-	} else if (phy_if_mode == PHY_INTERFACE_MODE_MII) {
+	} else if (ret == PHY_INTERFACE_MODE_MII) {
 		ar8xxx_write(priv, AR8229_REG_OPER_MODE0,
 				 AR8229_OPER_MODE0_PHY_MII_EN);
 	} else {
-- 
2.20.1

